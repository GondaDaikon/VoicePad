var toRoman = (function( ) {

    var roman = {
  
      '１':'1', '２':'2', '３':'3', '４':'4', '５':'5', '６':'6', '７':'7', '８':'8', '９':'9', '０':'0',
      '！':'!', '”':'"', '＃':'#', '＄':'$', '％':'%', '＆':'&', '’':"'", '（':'(', '）':')', '＝':'=',
      '〜':'~', '｜':'|', '＠':'@', '‘':'`', '＋':'+', '＊':'*', '；':";", '：':':', '＜':'<', '＞':'>',
      '、':',', '，':',', '。':'.', '／':'/', '？':'?', '＿':'_', '・':'･', '「':'[', '」':']', '｛':'{', '｝':'}',
      '￥':'\\', '＾':'^',

      'ａ':'a','ｂ':'b','ｃ':'c','ｄ':'d','ｅ':'e','ｆ':'f','ｇ':'g',
      'ｈ':'h','ｉ':'i','ｊ':'j','ｋ':'k','ｌ':'l','ｍ':'m','ｎ':'n',
      'ｏ':'o','ｐ':'p','ｑ':'q','ｒ':'r','ｓ':'s','ｔ':'t','ｕ':'u',
      'ｖ':'v','ｗ':'w','ｘ':'x','ｙ':'y','ｚ':'z',
      
      'ふぁ':'fa', 'ふぃ':'fi', 'ふぇ':'fe', 'ふぉ':'fo',
  
      'きゃ':'kya', 'きゅ':'kyu', 'きょ':'kyo',
      'しゃ':'sha', 'すぃ':'si', 'しゅ':'shu', 'しぇ':'she', 'しょ':'sho',
      'ちゃ':'cha', 'ちゅ':'chu', 'ちぇ':'che', 'ちょ':'cho',
      'にゃ':'nya', 'にゅ':'nyu', 'にょ':'nyo',
      'ひゃ':'hya', 'ひゅ':'hyu', 'ひょ':'hyo',
      'みゃ':'mya', 'みゅ':'myu', 'みょ':'myo',
      'りゃ':'rya', 'りゅ':'ryu', 'りょ':'ryo',

      'とぅ':'tu', 'てぃ':'ti', 'てゅ':'tyu',
      'つぁ':'tsa', 'つぃ':'tsi', 'つぇ':'tse', 'つぉ':'tso', 
      'でゅ':'dyu', 
      'にゃ':'nya', 'にゅ':'nyu', 'にょ':'nyo', 
  
      'ふゃ':'fya', 'ふゅ':'fyu', 'ふょ':'fyo',
      'ぴゃ':'pya', 'ぴゅ':'pyu', 'ぴょ':'pyo',
      'びゃ':'bya', 'びゅ':'byu', 'びょ':'byo',
      'ぢゃ':'dya', 'ぢゅ':'dyu', 'ぢょ':'dyo',
      'じゃ':'ja', 'ずぃ':'zi', 'じゅ':'ju', 'じぇ':'je', 'じょ':'jo', 
      'ぎゃ':'gya', 'ぎゅ':'gyu', 'ぎょ':'gyo',
  
      'ぱ':'pa', 'ぴ':'pi', 'ぷ':'pu', 'ぺ':'pe', 'ぽ':'po',
      'ば':'ba', 'び':'bi', 'ぶ':'bu', 'べ':'be', 'ぼ':'bo',
      'だ':'da', 'でぃ':'di', 'どぅ':'du', 'で':'de', 'ど':'do',
      'ざ':'za', 'じ':'ji', 'ず':'zu', 'ぜ':'ze', 'ぞ':'zo',
      'が':'ga', 'ぎ':'gi', 'ぐ':'gu', 'げ':'ge', 'ご':'go',
  
      'わ':'wa', 'ゐ':'wi', 'う':'wu', 'ゑ':'we', 'を':'wo',
      'ら':'ra', 'り':'ri', 'る':'ru', 'れ':'re', 'ろ':'ro',
      'や':'ya',            'ゆ':'yu',            'よ':'yo',
      'ま':'ma', 'み':'mi', 'む':'mu', 'め':'me', 'も':'mo',
      'は':'ha', 'ひ':'hi', 'ふ':'fu', 'へ':'he', 'ほ':'ho',
      'な':'na', 'に':'ni', 'ぬ':'nu', 'ね':'ne', 'の':'no',
      'た':'ta', 'ち':'chi', 'つ':'tsu', 'て':'te', 'と':'to',
      'さ':'sa', 'し':'shi', 'す':'su', 'せ':'se', 'そ':'so',
      'か':'ka', 'き':'ki', 'く':'ku', 'け':'ke', 'こ':'ko',
      'あ':'a', 'い':'i', 'う':'u', 'え':'e', 'お':'o',
      'ぁ':'la', 'ぃ':'li', 'ぅ':'lu', 'ぇ':'le', 'ぉ':'lo',
  
      'ヶ':'ke', 'ヵ':'ka',
      'ん':'n',  'ー':'-', '　':' '
  
    };
    var reg_tu  = /っ([bcdfghijklmnopqrstuvwyz])/gm;
    var reg_xtu = /っ/gm;
  
    return function ( str ) {
      var pnt = 0;
      var max = str.length;
      var s, r;
      var txt = '';
      
      while( pnt <= max ) {
        if( r = roman[ str.substring( pnt, pnt + 2 ) ] ) {
          txt += r;
          pnt += 2;
        } else {
          txt += ( r = roman[ s = str.substring( pnt, pnt + 1 ) ] ) ? r: s;
          pnt += 1;
        }
      }
      txt = txt.replace( reg_tu, '$1$1' );
      txt = txt.replace( reg_xtu, 'xtu' );
      return txt;
    };
  })();

var toFoumants = (function(){
  var phon1 = {
    "a" : [[800, 1200]],
    "i" : [[300, 2300]],
    "u" : [[300, 1200]],
    "e" : [[500, 1900]],
    "o" : [[500, 800 ]],
    "n" : [[200, 1500]],
    ',' : [[0, 0]]
  }
  var phon2 = {
    'wa': [[300, 1250],[800, 1200]], 'wo' : [[400, 1250],[500, 800]],
    'ra': [[620, 1450],[800, 1200]], 'ri': [[180, 2100],[300, 2300]], 'ru': [[180, 1450],[300, 1200]], 
    're': [[320, 1950],[500, 1900]], 'ro': [[320, 1200],[500, 800]],
    'ya': [[600, 1600],[800, 1200]],'yu' : [[300, 1800],[300, 1200]],'yo' : [[300, 2300],[500, 800]],
    'ma': [[650, 980 ],[800, 1200]], 'mi': [[210, 1800],[300, 2300]], 'mu': [[300, 1200],[300, 1200]], 
    'me': [[350, 1600],[500, 1900]], 'mo': [[350, 600],[500, 800]],
    'pa': [[0, 0],[650, 980 ],[800, 1200]], 'pi': [[0, 0],[210, 1800],[300, 2300]], 'pu': [[0, 0],[300, 1200],[300, 1200]], 
    'pe': [[0, 0],[350, 1600],[500, 1900]], 'po': [[0, 0],[350, 600],[500, 800]],
    'ba': [[650, 980 ],[800, 1200]], 'bi': [[210, 1800],[300, 2300]], 'bu': [[300, 1200],[300, 1200]], 
    'be': [[350, 1600],[500, 1900]], 'bo': [[350, 600],[500, 800]],
    'ha': [[800, 1200]], 'hi': [[300, 2300]], 'fu' : [[300, 1200]], 
    'he': [[500, 1900]], 'ho': [[500, 800]],
    'na': [[600, 1480],[800, 1200]], 'ni': [[180, 2100],[300, 2300]], 'nu': [[180, 1450],[300, 1200]], 
    'ne': [[320, 1950],[500, 1900]], 'no': [[320, 1200],[500, 800]],
    'ta': [[0, 0],[620, 1450],[800, 1200]], 
    'te': [[0, 0],[320, 1950],[500, 1900]], 'to': [[0, 0],[320, 1200],[500, 800]],
    'da': [[0, 0],[620, 1450],[800, 1200]], 'di': [[0, 0],[180, 2100],[300, 2300]], 'du': [[0, 0],[180, 1450],[300, 1200]], 
    'de': [[0, 0],[320, 1950],[500, 1900]], 'do': [[0, 0],[320, 1200],[500, 800]],
    'sa': [[0, 0],[620, 1450],[800, 1200]], 'su': [[0, 0],[180, 1450],[300, 1200]], 
    'se': [[0, 0],[320, 1950],[500, 1900]], 'so': [[0, 0],[320, 1200],[500, 800]],
    'za': [[0, 0],[620, 1450],[800, 1200]], 'zi': [[0, 0],[180, 2100],[300, 2300]], 'zu': [[0, 0],[180, 1450],[300, 1200]], 
    'ze': [[0, 0],[320, 1950],[500, 1900]], 'zo': [[0, 0],[320, 1200],[500, 800]],
    'ka': [[0, 0],[610, 1200],[800, 1200]], 'ki': [[0, 0],[180, 2550],[300, 2300]], 'ku': [[0, 0],[110, 1200],[300, 1200]], 
    'ke': [[0, 0],[350, 2200],[500, 1900]], 'ko': [[0, 0],[350, 520],[500, 800]],
    'ga': [[610, 1200],[800, 1200]], 'gi': [[180, 2550],[300, 2300]], 'gu': [[110, 1200],[300, 1200]], 
    'ge': [[350, 2200],[500, 1900]], 'go': [[350, 520],[500, 800]]
  }
  var phon3 = {
    'chi': [[0, 0],[180, 2100],[300, 2300]],
    'shi': [[0, 0],[180, 2100],[300, 2300]],
    'tsu': [[0, 0],[180, 1450],[300, 1200]]
  }

  
  return function(str){
    var pnt = 0;
    var max = str.length;
    var vec = [];
    var r;

    while( pnt <= max ) {
      if( r = phon3[ str.substring( pnt, pnt + 3 ) ]) { 
        r.forEach(r3 => {
          vec.push(r3);
        });
        pnt += 3;
      }else if( r = phon2[ str.substring( pnt, pnt + 2 ) ]){
        r.forEach(r2 => {
          vec.push(r2);
        });
        pnt += 2;
      }else if( r = phon1[ str.substring( pnt, pnt + 1) ]){
        r.forEach(r1 => {
          vec.push(r1);
        });
        pnt += 1;
      }else{
        pnt += 1;
      }
    }
    return vec;
  };
})();

var Foumants2Disp = (function(){
  return function(vec){
    let tmpX, tmpY, array = [], isFirst = true, islastDisp = true;
    vec.forEach(foumant => {
      let f1 = foumant[0],  f2 = foumant[1], bool;
      let random = Math.floor( Math.random() * (10 + 10) - 10);
      tmpX = Math.round(f1 / 1000 * 300) + random;
      tmpY = Math.round(300 - f2 / 3000 * 300) + random;
      if (f1 == 0 && f2 == 0 && islastDisp){
        bool = false;
        let disp = [0, 0, bool];
        if (!isFirst){
          islastDisp = false
          array.push(disp);
        } ;
      }else {
        bool = true;
        islastDisp = true
        let disp = [tmpX, tmpY, bool];
        array.push(disp);
      }
      console.log(f1)
      console.log(islastDisp)
      isFirst = false;
    });
    return array;
  };
})();